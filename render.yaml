# Render Blueprint - AI News Aggregator
# https://render.com/docs/blueprint-spec
#
# Deploy from branch: deployment
#
# Creates: PostgreSQL database + Web service (/health, /trigger-newsletter)
#
# Newsletter: Add a CRON JOB in Render Dashboard (New + â†’ Cron Job)
#   Command: python -m app.daily_runner
#   Schedule: 0 8 * * * (daily 8 AM UTC)
#   Env vars: DATABASE_URL, GEMINI_API_KEY, MY_EMAIL, APP_PASSWORD, SUBSCRIBERS_CSV_URL
#   Gmail SMTP works on Render paid cron (SMTP ports allowed). No GitHub Actions needed.
#
# CRON_SECRET: Optional. Set in Render to protect /trigger-newsletter for manual runs.

databases:
  - name: ai-news-aggregator-db
    plan: free
    databaseName: ai_news_aggregator
    user: ai_news_user

services:
  - type: web
    name: ai-news-api
    runtime: python
    plan: free
    branch: deployment
    healthCheckPath: /health
    buildCommand: pip install -r requirements.txt && python app/database/create_tables.py
    startCommand: python run_api.py
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: ai-news-aggregator-db
          property: connectionString
      - key: PYTHON_VERSION
        value: "3.12.3"
      # PORT: Do NOT set. Render injects PORT (default 10000) - override causes 502.
      - key: CRON_SECRET
        sync: false   # Optional. Set in Render + GitHub secrets. Leave empty for no protection.
      - key: GEMINI_API_KEY
        sync: false
      - key: MY_EMAIL
        sync: false
      # Resend (commented - switched to Gmail): - key: RESEND_API_KEY / FROM_EMAIL
      - key: APP_PASSWORD
        sync: false   # Gmail App Password - required for sending
      - key: SUBSCRIBERS_CSV_URL
        sync: false   # Google Sheet CSV URL for subscribers
